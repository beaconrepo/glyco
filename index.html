<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Glyco Ontology</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://d3js.org/d3.v7.min.js"></script>
</head>
<body>
  <div id="root"></div>
  <script type="module">
    // Paste the component code here


import React, { useState, useEffect, useRef } from 'react';
import * as d3 from 'd3';
import { Search, X } from 'lucide-react';

export default function OntologyVisualization() {
  const svgRef = useRef();
  const [searchTerm, setSearchTerm] = useState('');
  const [selectedNode, setSelectedNode] = useState(null);

  const glycoData = [
    { resource_name: "ACGG-DB", resource: "Database", datatype: "DNA sequence", topic_subentries: ["Diseases", "Gene / Protein / Glycoprotein", "Protocols"] },
    { resource_name: "CAZy", resource: "Database", datatype: "cazyme", topic_subentries: ["Glycobiology", "Carbohydrate-Active Enzymes", "Annotation", "Curation", "Genomics"] },
    { resource_name: "CarbBank", resource: "Database", datatype: "carbohydrates", topic_subentries: ["Carbohydrates", "Glycan structures"] },
    { resource_name: "CFG", resource: "Database", datatype: "Lectins and glycan-binding", topic_subentries: ["Glycobiology", "Functional Glycomics", "Glycan Proteins", "Bioinformatics"] },
    { resource_name: "ChEBI", resource: "Knowledgebase", datatype: "small molecules", topic_subentries: ["Curation", "Molecular Entity Search", "Ontology"] },
    { resource_name: "CSDB", resource: "Database", datatype: "Glycan", topic_subentries: ["Carbohydrates", "Taxonomy", "NMR Signal", "Carb Substructure"] },
    { resource_name: "CSDB_GT", resource: "Database", datatype: "cazyme", topic_subentries: ["Carbohydrates", "Enzymes"] },
    { resource_name: "EUROCarbDB", resource: "Database", datatype: "Glycan", topic_subentries: ["glycobiology", "glycomics", "Database Framework", "Bioinformatics"] },
    { resource_name: "GAG-DB", resource: "Database", datatype: "Glycosaminoglycan", topic_subentries: ["Proteins & Proteomes", "Glycomics", "Glycopedia"] },
    { resource_name: "GDGDB", resource: "Database", datatype: "DNA sequence", topic_subentries: ["Genomics", "Glycan"] },
    { resource_name: "Glyco.me", resource: "portal", datatype: "glycoscience", topic_subentries: ["Glycomics", "Gene Activity Prediction", "Data Mining"] },
    { resource_name: "Glyco@Expasy", resource: "portal", datatype: "glycoscience", topic_subentries: ["Protein glycosylation", "Bioinformatics", "Glycan and Glycome"] },
    { resource_name: "Glyco3D", resource: "portal", datatype: "3D structure", topic_subentries: ["NMR Spectra", "Carbohydrates", "3D Modelling"] },
    { resource_name: "GlycodomainViewer", resource: "Knowledgebase", datatype: "glycoprotein", topic_subentries: ["Proteomics", "Glycoproteomics", "Glycosylation site analysis"] },
    { resource_name: "GlycoEnzDB", resource: "Database", datatype: "pathway", topic_subentries: ["Glycosidase", "Transporter", "Regulator", "Gene Pathway Map"] },
    { resource_name: "GlycoEpitope", resource: "Database", datatype: "Glycan-binding", topic_subentries: ["carbohydrate antigens", "glyco-epitopes", "antibodies"] },
    { resource_name: "GlycoGene Database", resource: "Database", datatype: "DNA sequence", topic_subentries: ["glycosyltransferase", "sulfotransferases"] },
    { resource_name: "GlycomeDB", resource: "Database", datatype: "Glycan", topic_subentries: ["Glycan Structure", "Carbohydrates"] },
    { resource_name: "Glycomotif", resource: "Knowledgebase", datatype: "Glycan", topic_subentries: ["Annotation", "Whole-Glycan", "Motif"] },
    { resource_name: "GlyConnect", resource: "Knowledgebase", datatype: "glycan and glycoprotein", topic_subentries: ["glycoproteins", "glycosite", "glycan", "oligosaccharides"] },
    { resource_name: "GlycoProtDB", resource: "Database", datatype: "glycoprotein", topic_subentries: ["glycopeptide sequences", "LC/MS", "glycoproteomics"] },
    { resource_name: "GlycoShape", resource: "Knowledgebase", datatype: "3D structure", topic_subentries: ["3D structural data", "glycans"] },
    { resource_name: "GlyGen Sandbox", resource: "Knowledgebase", datatype: "Glycan", topic_subentries: ["Linked glycans", "Biosynthesis", "GlyTouCan"] },
    { resource_name: "ICL Glycan Microarrays", resource: "Knowledgebase", datatype: "Glycan", topic_subentries: ["Carbohydrate", "Oligiosaccharide", "Glycan", "Pathogen/Antigen"] },
    { resource_name: "IEDB", resource: "Knowledgebase", datatype: "binding", topic_subentries: ["T Cells", "Infectious Disease", "Allergy", "Autoimmunity"] },
    { resource_name: "IMGT", resource: "Knowledgebase", datatype: "immunoglobulins", topic_subentries: ["Immunogenetics", "Immunoinformatics", "Immune response"] },
    { resource_name: "IntAct", resource: "Knowledgebase", datatype: "binding", topic_subentries: ["Molecular interactions", "Genes", "Visualization"] },
    { resource_name: "iPTMnet", resource: "Knowledgebase", datatype: "protein", topic_subentries: ["Protein", "Phosphorylation"] },
    { resource_name: "MatrixDB", resource: "Database", datatype: "proteoglycans", topic_subentries: ["Proteins", "Proteoglycans", "Glycosaminoglycans"] },
    { resource_name: "MonosaccharideDB", resource: "Database", datatype: "Glycan", topic_subentries: ["Glycan Database", "Glycan Residues", "Carbohydrates"] },
    { resource_name: "NCFGâ€”Glybrary", resource: "Knowledgebase", datatype: "Glycan", topic_subentries: ["Glycan Data"] },
    { resource_name: "O-GlcNAcAtlas", resource: "Database", datatype: "protein", topic_subentries: ["O-GlcNAcylated Proteins", "O-GlcNAcylated Sites"] },
    { resource_name: "OGT-PIN", resource: "Knowledgebase", datatype: "protein", topic_subentries: ["O-GlcNAc", "OGT biology"] },
    { resource_name: "PubChem", resource: "Knowledgebase", datatype: "small molecules", topic_subentries: ["Molecular properties", "Chemical information"] },
    { resource_name: "PULDB", resource: "Database", datatype: "Cazyme", topic_subentries: ["Polysaccharide Utilization Loci", "Bacteroidetes", "Genomics", "Glycans", "CAZymes"] },
    { resource_name: "Rhea", resource: "Knowledgebase", datatype: "pathway", topic_subentries: ["Enzyme", "Chemical", "Sequence"] },
    { resource_name: "SugarBind", resource: "database", datatype: "binding", topic_subentries: ["pathogen-glycan binding"] },
    { resource_name: "UniCarb-DB", resource: "database", datatype: "MS", topic_subentries: ["Glycan", "Carbohydrates", "Peptides"] },
    { resource_name: "UniCarbKB", resource: "Database", datatype: "Pathway", topic_subentries: ["carbohydrates", "glycoproteins"] },
    { resource_name: "UniLectin", resource: "Knowledgebase", datatype: "Lectins", topic_subentries: ["Lectins", "Visualization"] },
    { resource_name: "UniProtKB", resource: "Knowledgebase", datatype: "Proteins", topic_subentries: ["Protein", "Proteomics", "Peptide"] },
  ];

  // Sort alphabetically
  const sortedData = [...glycoData].sort((a, b) => a.resource_name.localeCompare(b.resource_name));

  const filteredData = sortedData.filter(d =>
    d.resource_name.toLowerCase().includes(searchTerm.toLowerCase()) ||
    d.datatype.toLowerCase().includes(searchTerm.toLowerCase()) ||
    d.topic_subentries.some(t => t.toLowerCase().includes(searchTerm.toLowerCase()))
  );

  useEffect(() => {
    if (!svgRef.current) return;

    const width = svgRef.current.clientWidth;
    const height = svgRef.current.clientHeight;
    const nodeRadius = 45;

    // Create nodes in alphabetical order arranged in circular/grid pattern
    const nodes = filteredData.map((d, i) => {
      const cols = Math.ceil(Math.sqrt(filteredData.length));
      const row = Math.floor(i / cols);
      const col = i % cols;
      
      const x = 120 + col * 150;
      const y = 100 + row * 150;

      return {
        id: d.resource_name,
        name: d.resource_name,
        resource: d.resource,
        datatype: d.datatype,
        topics: d.topic_subentries,
        x,
        y,
      };
    });

    // Clear previous content
    d3.select(svgRef.current).selectAll('*').remove();

    const svg = d3.select(svgRef.current)
      .attr('width', width)
      .attr('height', height);

    // Add zoom behavior
    const zoom = d3.zoom()
      .on('zoom', (event) => {
        g.attr('transform', event.transform);
      });

    svg.call(zoom);

    const g = svg.append('g');

    // Draw nodes (circles)
    const nodeCircles = g.append('g')
      .selectAll('circle')
      .data(nodes)
      .join('circle')
      .attr('cx', d => d.x)
      .attr('cy', d => d.y)
      .attr('r', nodeRadius)
      .attr('fill', d => {
        if (d.resource === 'Database') return '#3b82f6';
        if (d.resource === 'Knowledgebase') return '#10b981';
        return '#f59e0b';
      })
      .attr('stroke', d => selectedNode === d.id ? '#fbbf24' : '#fff')
      .attr('stroke-width', d => selectedNode === d.id ? 4 : 2)
      .style('cursor', 'pointer')
      .attr('class', 'transition-all')
      .on('click', (event, d) => {
        setSelectedNode(selectedNode === d.id ? null : d.id);
        event.stopPropagation();
      })
      .on('mouseover', function() {
        d3.select(this).attr('filter', 'drop-shadow(0 0 8px rgba(255,255,255,0.5))');
      })
      .on('mouseout', function() {
        d3.select(this).attr('filter', 'none');
      });

    // Add labels
    const labels = g.append('g')
      .selectAll('text')
      .data(nodes)
      .join('text')
      .attr('x', d => d.x)
      .attr('y', d => d.y)
      .attr('text-anchor', 'middle')
      .attr('dy', '.3em')
      .attr('font-size', '11px')
      .attr('font-weight', 'bold')
      .attr('fill', '#fff')
      .attr('pointer-events', 'none')
      .style('word-wrap', 'break-word')
      .text(d => {
        const name = d.name;
        if (name.length > 12) {
          return name.substring(0, 10) + '...';
        }
        return name;
      });

  }, [filteredData, selectedNode]);

  const selectedNodeData = glycoData.find(d => d.resource_name === selectedNode);

  return (
    <div className="w-full h-screen bg-gradient-to-br from-slate-900 to-slate-800 flex flex-col">
      {/* Header */}
      <div className="bg-slate-800 border-b border-slate-700 p-4 sticky top-0 z-10">
        <h1 className="text-2xl font-bold text-white mb-3">Glycoscience Resources Ontology</h1>
        <div className="flex gap-3 flex-wrap mb-3">
          <div className="flex items-center gap-2">
            <div className="w-4 h-4 rounded-full bg-blue-500"></div>
            <span className="text-sm text-gray-300">Database ({glycoData.filter(d => d.resource === 'Database').length})</span>
          </div>
          <div className="flex items-center gap-2">
            <div className="w-4 h-4 rounded-full bg-green-500"></div>
            <span className="text-sm text-gray-300">Knowledgebase ({glycoData.filter(d => d.resource === 'Knowledgebase').length})</span>
          </div>
          <div className="flex items-center gap-2">
            <div className="w-4 h-4 rounded-full bg-amber-500"></div>
            <span className="text-sm text-gray-300">Portal ({glycoData.filter(d => d.resource === 'portal').length})</span>
          </div>
        </div>
        <div className="relative">
          <Search className="absolute left-3 top-3 w-4 h-4 text-gray-400" />
          <input
            type="text"
            placeholder="Search resources..."
            value={searchTerm}
            onChange={(e) => setSearchTerm(e.target.value)}
            className="w-full pl-10 pr-4 py-2 bg-slate-700 text-white rounded border border-slate-600 focus:outline-none focus:border-blue-500"
          />
        </div>
      </div>

      {/* Main visualization area */}
      <div className="flex-1 flex gap-4 overflow-hidden p-4">
        {/* SVG Canvas */}
        <div className="flex-1 bg-slate-700 rounded-lg overflow-auto shadow-lg">
          <svg ref={svgRef} className="w-full" style={{ minHeight: '100%' }} />
        </div>

        {/* Details Panel */}
        <div className="w-80 bg-slate-800 rounded-lg shadow-lg border border-slate-700 overflow-hidden flex flex-col">
          {selectedNodeData ? (
            <>
              <div className="bg-slate-700 p-4 border-b border-slate-600 flex items-center justify-between">
                <h2 className="text-lg font-bold text-white">{selectedNodeData.resource_name}</h2>
                <button
                  onClick={() => setSelectedNode(null)}
                  className="text-gray-400 hover:text-white transition"
                >
                  <X className="w-5 h-5" />
                </button>
              </div>
              <div className="p-4 overflow-y-auto flex-1 space-y-4">
                <div>
                  <span className="text-gray-400 text-sm">Type:</span>
                  <span className="ml-2 px-2 py-1 bg-blue-600 text-white rounded text-xs font-semibold">
                    {selectedNodeData.resource}
                  </span>
                </div>
                <div>
                  <span className="text-gray-400 text-sm">Data Type:</span>
                  <p className="mt-1 text-white text-sm">{selectedNodeData.datatype}</p>
                </div>
                <div>
                  <span className="text-gray-400 text-sm block mb-2">Topics:</span>
                  <div className="flex flex-wrap gap-2">
                    {selectedNodeData.topic_subentries.map((topic, i) => (
                      <span key={i} className="px-2 py-1 bg-slate-700 text-gray-200 rounded text-xs">
                        {topic}
                      </span>
                    ))}
                  </div>
                </div>
              </div>
            </>
          ) : (
            <div className="flex items-center justify-center h-full text-gray-400 text-center p-4">
              <p>Click on a node to view details</p>
            </div>
          )}
        </div>
      </div>
    </div>
  );
}
  </script>
</body>
</html>
